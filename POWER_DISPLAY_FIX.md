# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ Bluetti

## –ü—Ä–æ–±–ª–µ–º–∞
–£ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∞—Å—è –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å:
- **–ë–∞—Ç–∞—Ä–µ—è:** 100%
- **AC:** 17W (–ø–æ–∫–∞–∑—É–≤–∞–ª–æ—Å—è —Ç—ñ–ª—å–∫–∏ —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è)
- **–í—Ö—ñ–¥:** 122W (–∑–∞–≥–∞–ª—å–Ω–∞ –≤—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å)

–ê–ª–µ **–ù–ï** –ø–æ–∫–∞–∑—É–≤–∞–ª–æ—Å—è —â–æ **122W –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É —á–µ—Ä–µ–∑ AC Input**.

## –ü–æ—è—Å–Ω–µ–Ω–Ω—è –ø–æ—Ç—É–∂–Ω–æ—Å—Ç–µ–π Bluetti

### Input (–í—Ö—ñ–¥):
- **AC Input Power** - –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —â–æ –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ 220V
- **DC Input Power** - –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —â–æ –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É –≤—ñ–¥ —Å–æ–Ω—è—á–Ω–∏—Ö –ø–∞–Ω–µ–ª–µ–π
- **Total Input Power** = AC Input + DC Input

### Output (–í–∏—Ö—ñ–¥):
- **AC Output Power** - –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —â–æ —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è –∑ AC —Ä–æ–∑–µ—Ç–æ–∫ (220V)
- **DC Output Power** - –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å —â–æ —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è –∑ DC –ø–æ—Ä—Ç—ñ–≤ (USB, 12V)

### –ü—Ä–∏–∫–ª–∞–¥:
```
AC Input: 122W   ‚Üí –ó–∞—Ä—è–¥–∫–∞ –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ
AC Output: 17W   ‚Üí –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è –∑ AC —Ä–æ–∑–µ—Ç–∫–∏
DC Input: 0W     ‚Üí –ù–µ–º–∞—î —Å–æ–Ω—è—á–Ω–∏—Ö –ø–∞–Ω–µ–ª–µ–π
DC Output: 0W    ‚Üí –ù—ñ—á–æ–≥–æ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ USB

–ë–∞–ª–∞–Ω—Å: +122W - 17W = +105W –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É –±–∞—Ç–∞—Ä–µ—ó
```

---

## –†—ñ—à–µ–Ω–Ω—è

### 1. –î–æ–¥–∞–Ω–æ AC Input —Ç–∞ DC Input –¥–æ JSON API
**–§–∞–π–ª:** `src/web_server.cpp`

**–ë—É–ª–æ:**
```cpp
doc["battery_level"] = status->batteryLevel;
doc["ac_power"] = status->acPower;
doc["dc_power"] = status->dcPower;
doc["input_power"] = status->inputPower;
doc["ac_state"] = status->acOutputState;
doc["dc_state"] = status->dcOutputState;
```

**–°—Ç–∞–ª–æ:**
```cpp
doc["battery_level"] = status->batteryLevel;
doc["ac_power"] = status->acPower;
doc["dc_power"] = status->dcPower;
doc["input_power"] = status->inputPower;
doc["ac_input_power"] = status->acInputPower;  // ‚úÖ –î–æ–¥–∞–Ω–æ
doc["dc_input_power"] = status->dcInputPower;  // ‚úÖ –î–æ–¥–∞–Ω–æ
doc["ac_state"] = status->acOutputState;
doc["dc_state"] = status->dcOutputState;
```

---

### 2. –ü–æ–∫—Ä–∞—â–µ–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ
**–§–∞–π–ª:** `src/web_server.cpp`

**–ë—É–ª–æ:**
```javascript
document.getElementById('ac').textContent=(d.ac_state?'ON':'OFF')+' / '+d.ac_power+'W';
document.getElementById('dc').textContent=(d.dc_state?'ON':'OFF')+' / '+d.dc_power+'W';
```

**–°—Ç–∞–ª–æ:**
```javascript
var acText=(d.ac_state?'ON':'OFF')+' '+d.ac_power+'W';
if(d.ac_input_power>0)acText+=' (‚ö°'+d.ac_input_power+'W)';
document.getElementById('ac').textContent=acText;

var dcText=(d.dc_state?'ON':'OFF')+' '+d.dc_power+'W';
if(d.dc_input_power>0)dcText+=' (‚ö°'+d.dc_input_power+'W)';
document.getElementById('dc').textContent=dcText;
```

---

## –Ø–∫ –≤–∏–≥–ª—è–¥–∞—î —Ç–µ–ø–µ—Ä

### –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å:
```
üîã Bluetti
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–°—Ç–∞—Ç—É—Å: –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ

–ë–∞—Ç–∞—Ä–µ—è:  100%
AC:       ON 17W (‚ö°122W)     ‚Üê Output 17W, Input 122W
DC:       OFF 0W               ‚Üê –ù—ñ—á–æ–≥–æ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ
–í—Ö—ñ–¥:     122W                 ‚Üê –ó–∞–≥–∞–ª—å–Ω–∞ –≤—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å
–ó–∞—Ä—è–¥–∫–∞:  Silent               ‚Üê –†–µ–∂–∏–º –∑–∞—Ä—è–¥–∫–∏
```

### –ü–æ—è—Å–Ω–µ–Ω–Ω—è:
- **AC: ON 17W (‚ö°122W)**
  - `ON` - AC —Ä–æ–∑–µ—Ç–∫–∞ —É–≤—ñ–º–∫–Ω–µ–Ω–∞
  - `17W` - —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è –∑ —Ä–æ–∑–µ—Ç–∫–∏ (Output)
  - `‚ö°122W` - –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ (Input)
  
- **DC: OFF 0W**
  - `OFF` - DC –ø–æ—Ä—Ç–∏ –≤–∏–º–∫–Ω–µ–Ω—ñ
  - `0W` - –Ω—ñ—á–æ–≥–æ –Ω–µ —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è
  - –Ø–∫—â–æ —î —Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ: `OFF 0W (‚ö°50W)`

---

## –†–µ–≥—ñ—Å—Ç—Ä–∏ Bluetti EB3A

### Input Power (Page 0x00):
```
–†–µ–≥—ñ—Å—Ç—Ä 0x0024 (offset 55-56): DC Input Power (W)
–†–µ–≥—ñ—Å—Ç—Ä 0x0025 (offset 57-58): AC Input Power (W)
```

### Output Power (Page 0x00):
```
–†–µ–≥—ñ—Å—Ç—Ä 0x0026 (offset 59-60): AC Output Power (W)
–†–µ–≥—ñ—Å—Ç—Ä 0x0027 (offset 61-62): DC Output Power (W)
```

### –ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:
```
Data: 01 03 50 45 42 33 41 ... 00 00 00 7A 00 11 00 00 00 00 ...
                                    ‚Üë     ‚Üë     ‚Üë     ‚Üë
                              DC In AC In AC Out DC Out
                              (0W)  (122W) (17W)  (0W)
```

### –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ offset—ñ–≤:
```
–†–µ–≥—ñ—Å—Ç—Ä 0x0024: offset = 3 + (0x24 - 0x0A) √ó 2 = 3 + 26 √ó 2 = 55
–†–µ–≥—ñ—Å—Ç—Ä 0x0025: offset = 3 + (0x25 - 0x0A) √ó 2 = 3 + 27 √ó 2 = 57
–†–µ–≥—ñ—Å—Ç—Ä 0x0026: offset = 3 + (0x26 - 0x0A) √ó 2 = 3 + 28 √ó 2 = 59
–†–µ–≥—ñ—Å—Ç—Ä 0x0027: offset = 3 + (0x27 - 0x0A) √ó 2 = 3 + 29 √ó 2 = 61
```

---

## –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤ Serial Monitor

### –ë—É–ª–æ:
```
[Bluetti] –í—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: 122W (DC: 0W, AC: 122W)
[Bluetti] AC –≤–∏—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: 17W
[Bluetti] DC –≤–∏—Ö—ñ–¥–Ω–∞ –ø–æ—Ç—É–∂–Ω—ñ—Å—Ç—å: 0W
```

### –ó–∞–ª–∏—à–∏–ª–æ—Å—è —Ç–∞–∫ —Å–∞–º–æ (–ª–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∞–≤–∏–ª—å–Ω–µ)
–ü—Ä–æ–±–ª–µ–º–∞ –±—É–ª–∞ —Ç—ñ–ª—å–∫–∏ —É –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ.

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–∞—Ä—è–¥–∫–∞ –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ:
```
AC Input:  122W  ‚Üí –°—Ç–∞–Ω—Ü—ñ—è –∑–∞—Ä—è–¥–∂–∞—î—Ç—å—Å—è
AC Output:  17W  ‚Üí ESP32 —Å–ø–æ–∂–∏–≤–∞—î –µ–Ω–µ—Ä–≥—ñ—é
Balance:   +105W ‚Üí –ô–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É –±–∞—Ç–∞—Ä–µ—ó
```

### 2. –ó–∞—Ä—è–¥–∫–∞ –≤—ñ–¥ —Å–æ–Ω—Ü—è:
```
DC Input:   50W  ‚Üí –°–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ
AC Output:  20W  ‚Üí –°–ø–æ–∂–∏–≤–∞–Ω–Ω—è
Balance:   +30W  ‚Üí –ô–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É
```

### 3. –†–æ–∑—Ä—è–¥–∫–∞:
```
AC Input:    0W  ‚Üí –ù–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ –º–µ—Ä–µ–∂—ñ
AC Output: 100W  ‚Üí –ü—Ä–∞—Ü—é—î —á–∞–π–Ω–∏–∫
Balance:  -100W  ‚Üí –†–æ–∑—Ä—è–¥–∂–∞—î—Ç—å—Å—è –±–∞—Ç–∞—Ä–µ—è
```

---

## –ü–µ—Ä–µ–≤–∞–≥–∏ –Ω–æ–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è

‚úÖ **–ó—Ä–æ–∑—É–º—ñ–ª–æ —â–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è:**
- –ë–∞—á–∏–º–æ —Å–∫—ñ–ª—å–∫–∏ –π–¥–µ –Ω–∞ –∑–∞—Ä—è–¥–∫—É (‚ö°122W)
- –ë–∞—á–∏–º–æ —Å–∫—ñ–ª—å–∫–∏ —Å–ø–æ–∂–∏–≤–∞—î—Ç—å—Å—è (17W)
- –ë–∞—á–∏–º–æ –±–∞–ª–∞–Ω—Å (122W - 17W = +105W)

‚úÖ **–ö–æ–º–ø–∞–∫—Ç–Ω–æ:**
- –í—Å–µ –≤ –æ–¥–Ω–æ–º—É —Ä—è–¥–∫—É: `ON 17W (‚ö°122W)`
- –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –ø–æ–ª—ñ–≤

‚úÖ **–ï–º–æ–¥–∑—ñ ‚ö° –¥–ª—è –∑—Ä–æ–∑—É–º—ñ–ª–æ—Å—Ç—ñ:**
- ‚ö° = –µ–ª–µ–∫—Ç—Ä–∏–∫–∞ –π–¥–µ –≤ –±–∞—Ç–∞—Ä–µ—é (–∑–∞—Ä—è–¥–∫–∞)

‚úÖ **–ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ:**
- –Ø–∫—â–æ AC Input = 0, —Ç–æ `(‚ö°0W)` –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è
- –Ø–∫—â–æ DC Input = 0, —Ç–æ `(‚ö°0W)` –Ω–µ –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è

---

## API Endpoints

### GET /status
```json
{
  "battery_level": 100,
  "ac_power": 17,           // AC Output (—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è)
  "dc_power": 0,            // DC Output (—Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è)
  "input_power": 122,       // Total Input (–∑–∞—Ä—è–¥–∫–∞)
  "ac_input_power": 122,    // AC Input (–∑–∞—Ä—è–¥–∫–∞ –≤—ñ–¥ –º–µ—Ä–µ–∂—ñ)
  "dc_input_power": 0,      // DC Input (—Å–æ–Ω—è—á–Ω—ñ –ø–∞–Ω–µ–ª—ñ)
  "ac_state": true,
  "dc_state": false
}
```

---

## Home Assistant MQTT

–¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ–Ω—Å–æ—Ä–∏:
```yaml
sensor:
  - platform: mqtt
    name: "Bluetti AC Input"
    state_topic: "bluetti/ac_input_power"
    unit_of_measurement: "W"
    
  - platform: mqtt
    name: "Bluetti DC Input"
    state_topic: "bluetti/dc_input_power"
    unit_of_measurement: "W"
```

---

## –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω–æ

1. **src/web_server.cpp:**
   - –î–æ–¥–∞–Ω–æ `ac_input_power` —Ç–∞ `dc_input_power` –¥–æ JSON
   - –ó–º—ñ–Ω–µ–Ω–æ JavaScript –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è Input –≤ –¥—É–∂–∫–∞—Ö

---

## –ö–æ–º–ø—ñ–ª—è—Ü—ñ—è

‚úÖ **SUCCESS**
- RAM: 17.3% (56564 bytes)
- Flash: 93.8% (1229921 bytes)
- –†–æ–∑–º—ñ—Ä –∑–±—ñ–ª—å—à–∏–≤—Å—è –Ω–∞ 244 bytes (–±—É–ª–æ 1229677)

---

–°—Ç–≤–æ—Ä–µ–Ω–æ: 8 –≥—Ä—É–¥–Ω—è 2025
