# ⚠️ ВАЖЛИВО: Перше завантаження через USB

## Проблема

Ви бачите помилку:
```
ERROR: File too large! Max: 1310720 bytes, Got: 1734794
```

**Це означає, що ESP32 все ще працює зі старою прошивкою**, яка має обмеження 1.3MB.

## Рішення

**Потрібно завантажити нову прошивку через USB кабель** (не через OTA).

### Крок 1: Підключіть ESP32 через USB

1. Підключіть ESP32 до комп'ютера через USB кабель
2. Переконайтеся, що кабель підтримує передачу даних (не тільки зарядка)

### Крок 2: Завантажте прошивку через USB

```bash
cd /home/kekcick/Documents/esp32
pio run --target upload
```

**Якщо використовуєте CH9102F чип (як в T-Display):**
- Утримуйте кнопку **BOOT** під час "Connecting..."
- Відпустіть кнопку після початку завантаження

### Крок 3: Перевірте Serial Monitor

Після завантаження, перевірте логи:

```bash
pio device monitor
```

**Шукайте:**
```
[Bluetti] Initializing ESP32 BLE...
[Bluetti] ESP32 BLE initialized
```

**НЕ має бути:**
```
I NimBLERemoteCharacteristic  # ← Це стара прошивка!
```

### Крок 4: Перевірте OTA

Після успішного завантаження через USB, перевірте:

```
OTA ready on port 3232
```

Якщо бачите це - OTA готовий!

## Наступні оновлення через OTA

**Після першого завантаження через USB**, наступні оновлення можна робити через OTA:

```bash
# Через PlatformIO
pio run --target upload --upload-port ESP32-Bluetti-EB3A.local

# Або через Makefile
make ota IP=192.168.1.XXX
```

## Чому не працює OTA зараз?

1. **Стара прошивка** має обмеження 1.3MB
2. **Нова прошивка** 1.7MB (ESP32 BLE бібліотека більша)
3. **OTA не може оновити** прошивку, яка більша за поточне обмеження
4. **Тому потрібен USB** для першого завантаження

## Якщо USB не працює

### Перевірте порт:

```bash
# Показати доступні порти
pio device list

# Або на Linux
ls /dev/ttyUSB* /dev/ttyACM*
```

### Перевірте права доступу:

```bash
# Додати користувача до групи dialout
sudo usermod -a -G dialout $USER

# Перезавантажити сесію (вийти/увійти)
```

### Перевірте кабель:

- Використовуйте якісний USB кабель
- Переконайтеся, що кабель підтримує передачу даних
- Спробуйте інший кабель

---

**Після завантаження через USB, OTA працюватиме для всіх наступних оновлень!** ✅

