# Release Notes v1.2.2

## üêõ –ö–†–ò–¢–ò–ß–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤

### –ü—Ä–æ–±–ª–µ–º–∞ (–í–ò–Ø–í–õ–ï–ù–û –î–û–î–ê–¢–ö–û–í–û!)
**–í–µ—Ä—Å—ñ—è 1.2.1 –ù–ï –ü–û–í–ù–Ü–°–¢–Æ –≤–∏–ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–±–ª–µ–º—É!**

–í—ñ–¥–ø–æ–≤—ñ–¥—ñ –≤—ñ–¥ —Ä—ñ–∑–Ω–∏—Ö —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤ –ø–ª—É—Ç–∞–ª–∏—Å—è –º—ñ–∂ —Å–æ–±–æ—é:

**–°–∏–º–ø—Ç–æ–º–∏:**
- ECO —Ä–µ–∂–∏–º **—Å–∞–º–æ—Å—Ç—ñ–π–Ω–æ —É–≤—ñ–º–∫–Ω—É–≤–∞–≤—Å—è** –±–µ–∑ –∫–æ–º–∞–Ω–¥–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- –†–µ–∂–∏–º–∏ TURBO/SILENT/STANDARD **–ø—Ä–∞—Ü—é–≤–∞–ª–∏ –Ω–µ–≤—ñ—Ä–Ω–æ**
- –í—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥ Charging Mode (0x0BF9) —ñ–Ω—Ç–µ—Ä–ø—Ä–µ—Ç—É–≤–∞–ª–∞—Å—è —è–∫ ECO Mode (0x0BF7)
- –í—ñ–¥–ø–æ–≤—ñ–¥—å `01 03 02 00 01 79 84` –æ–±—Ä–æ–±–ª—è–ª–∞—Å—è **–¥–≤—ñ—á—ñ** –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤

**–ü—Ä–∏—á–∏–Ω–∞ (–ó–ù–ê–ô–î–ï–ù–û –°–ü–†–ê–í–ñ–ù–Æ!):**
1. –ó–∞—Ç—Ä–∏–º–∫–∏ 100ms –º—ñ–∂ –∑–∞–ø–∏—Ç–∞–º–∏ –±—É–ª–∏ **–ù–ï–î–û–°–¢–ê–¢–ù–Ü**
2. **–§—É–Ω–∫—Ü—ñ—è `requestChargingMode()` –ù–ï –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞–ª–∞ `lastSingleRegisterRequested`!**
3. Bluetti –Ω–∞–¥—Å–∏–ª–∞–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ ESP32 –≤—Å—Ç–∏–≥–∞–≤ —ó—Ö –æ–±—Ä–æ–±–∏—Ç–∏ —Ç–∞ –æ—á–∏—Å—Ç–∏—Ç–∏ –∑–º—ñ–Ω–Ω—É

**–î–æ–∫–∞–∑–∏ –∑ –ª–æ–≥—ñ–≤:**
```
[Bluetti] Requesting charging mode from 0x0BF9... ‚úÖ    ‚Üê –ó–∞–ø–∏—Ç 0x0BF9
[Bluetti] Data: 01 03 02 00 01 79 84                   ‚Üê –í—ñ–¥–ø–æ–≤—ñ–¥—å value=1
[Bluetti] üîã Charging mode: SILENT (value=1)           ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–æ!

[Bluetti] Requesting register 0x0BF7...                ‚Üê –ó–∞–ø–∏—Ç 0x0BF7 (ECO)
[Bluetti] Data: 01 03 02 00 01 79 84                   ‚Üê –¢–ê –ñ –í–Ü–î–ü–û–í–Ü–î–¨!
[Bluetti] üåø ECO mode: ON (reg=0x0BF7, value=1)        ‚Üê –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
```

### –†—ñ—à–µ–Ω–Ω—è v1.2.2 v3 (–û–°–¢–ê–¢–û–ß–ù–ï –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø)

‚úÖ **–ó–±—ñ–ª—å—à–µ–Ω–æ –∑–∞—Ç—Ä–∏–º–∫–∏:**
- `requestRegister()`: –∑–±—ñ–ª—å—à–µ–Ω–æ –∑ 300ms –¥–æ **500ms** –ø—ñ—Å–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∫–æ–º–∞–Ω–¥–∏
- `requestStatus()`: –¥–æ–¥–∞–Ω–æ `delay(1000)` –≤ **–ö–Ü–ù–ï–¶–¨ —Ñ—É–Ω–∫—Ü—ñ—ó** –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –¢–µ–ø–µ—Ä –∑–∞—Ç—Ä–∏–º–∫–∞ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è **–ü–Ü–°–õ–Ø** –æ–±—Ä–æ–±–∫–∏ –≤–µ–ª–∏–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É, –∞ –Ω–µ –¥–æ

‚úÖ **–í–ò–î–ê–õ–ï–ù–û —Ñ—É–Ω–∫—Ü—ñ—é `requestChargingMode()`:**
- –§—É–Ω–∫—Ü—ñ—è –Ω–µ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞–ª–∞ `lastSingleRegisterRequested` - —Ü–µ –±—É–ª–∞ **–ö–û–†–Ü–ù–¨ –ü–†–û–ë–õ–ï–ú–ò**!
- –ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π `requestRegister(0x0BF9)` —É –≤—Å—ñ—Ö –º—ñ—Å—Ü—è—Ö
- –í–∏–¥–∞–ª–µ–Ω–æ –∑ `setChargingSpeed()` —Ç–∞ `loop()`
- –í–∏–¥–∞–ª–µ–Ω–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑ `bluetti_device.h`

‚úÖ **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è:**
- –î–æ–¥–∞–Ω–æ `lastSingleRegisterRequested = 0` –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- –î–æ–¥–∞–Ω–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏—á–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è `[Bluetti] Requesting register 0x%04X...`
- –î–æ–¥–∞–Ω–æ `[Bluetti] Single register response for 0x%04X: value=%d`
- **–í–°–Ü** –∑–∞–ø–∏—Ç–∏ —Ä–µ–≥—ñ—Å—Ç—Ä—ñ–≤ —Ç–µ–ø–µ—Ä –ø—Ä–æ—Ö–æ–¥—è—Ç—å —á–µ—Ä–µ–∑ `requestRegister()` –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é
- Bluetti –º–∞—î —á–∞—Å "–∑–∞—Å–ø–æ–∫–æ—ó—Ç–∏—Å—è" –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –≤–µ–ª–∏–∫–æ–≥–æ –∑–∞–ø–∏—Ç—É –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—É–ø–Ω–∏–º–∏ –∑–∞–ø–∏—Ç–∞–º–∏

### –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ —Ä–µ–∂–∏–º–∏ –∑–∞—Ä—è–¥–∫–∏

–ó–Ω–∞—á–µ–Ω–Ω—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω—ñ –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é [bluetti_mqtt](https://github.com/warhammerkid/bluetti_mqtt):

| –†–µ–∂–∏–º | –ö–æ–¥ | –ü–æ—Ç—É–∂–Ω—ñ—Å—Ç—å |
|-------|-----|------------|
| STANDARD | 0 | max 268W |
| SILENT | 1 | ~100W |
| TURBO | 2 | max 350W |

## üìù –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### –ó–º—ñ–Ω–µ–Ω—ñ —Ñ–∞–π–ª–∏
- `src/bluetti_device.cpp`:
  - `requestRegister()`: –∑–±—ñ–ª—å—à–µ–Ω–æ –∑–∞—Ç—Ä–∏–º–∫—É –∑ 300ms –¥–æ **500ms** —Ç–∞ –¥–æ–¥–∞–Ω–æ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É
  - `requestStatus()`: **–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ `delay(1000)` –≤ –ö–Ü–ù–ï–¶–¨ —Ñ—É–Ω–∫—Ü—ñ—ó** –ø—ñ—Å–ª—è –æ–±—Ä–æ–±–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
  - `loop()`: –≤–∏–¥–∞–ª–µ–Ω–æ `delay(1000)` (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ `requestStatus()`)
  - `pollFeatureState()`: –≤–∏–¥–∞–ª–µ–Ω–æ `delay(100)` –º—ñ–∂ case
  - `handleNotification()`: –¥–æ–¥–∞–Ω–æ –æ—á–∏—â–µ–Ω–Ω—è `lastSingleRegisterRequested = 0`
  - `setChargingSpeed()`: –∑–∞–º—ñ–Ω–µ–Ω–æ `requestChargingMode()` –Ω–∞ `requestRegister(0x0BF9)`
  - **–í–ò–î–ê–õ–ï–ù–û —Ñ—É–Ω–∫—Ü—ñ—é `requestChargingMode()`** - –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π `requestRegister()`
- `include/bluetti_device.h`:
  - –í–∏–¥–∞–ª–µ–Ω–æ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è `void requestChargingMode()`

### –ö–ª—é—á–æ–≤—ñ –∑–º—ñ–Ω–∏ –≤ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

**–î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```cpp
requestStatus();          // –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–∞–ø–∏—Ç
delay(1000);              // —á–µ–∫–∞—î –î–û –æ–±—Ä–æ–±–∫–∏ ‚Üê –ü–û–ú–ò–õ–ö–ê!
pollFeatureState();       // –≤—ñ–¥—Ä–∞–∑—É –æ–ø–∏—Ç—É—î —Ä–µ–≥—ñ—Å—Ç—Ä–∏
```

**–ü–Ü–°–õ–Ø (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```cpp
requestStatus() {
  // –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î –∑–∞–ø–∏—Ç
  // —á–µ–∫–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–¥–æ 2 —Å–µ–∫—É–Ω–¥)
  // –æ–±—Ä–æ–±–ª—è—î –≤—ñ–¥–ø–æ–≤—ñ–¥—å
  delay(1000);            // —á–µ–∫–∞—î –ü–Ü–°–õ–Ø –æ–±—Ä–æ–±–∫–∏ ‚Üê –í–ò–ü–†–ê–í–õ–ï–ù–û!
}
pollFeatureState();       // –æ–ø–∏—Ç—É—î —Ä–µ–≥—ñ—Å—Ç—Ä–∏ –∑ –∑–∞—Ç—Ä–∏–º–∫–æ—é 500ms
```

### –ü–æ–ª—ñ–ø—à–µ–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–¢–µ–ø–µ—Ä –ª–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å –ø–æ–≤–Ω—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—é:
```
[Bluetti] Requesting register 0x0BF9...
[Bluetti] Single register response for 0x0BF9: value=1 (0x0001)
[Bluetti] üîã Charging mode: SILENT (value=1)

[Bluetti] Requesting register 0x0BF7...
[Bluetti] Single register response for 0x0BF7: value=0 (0x0000)
[Bluetti] üåø ECO mode: OFF (reg=0x0BF7, value=0)
```

**–ö–æ–∂–µ–Ω —Ä–µ–≥—ñ—Å—Ç—Ä –æ—Ç—Ä–∏–º—É—î —Å–≤–æ—é —É–Ω—ñ–∫–∞–ª—å–Ω—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å!**

## üîó –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- GitHub: https://github.com/kekcick1/esp32-bluetti-bridge
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è: [CHARGING_MODE_DEBUG.md](CHARGING_MODE_DEBUG.md)

## ‚¨ÜÔ∏è –û–Ω–æ–≤–ª–µ–Ω–Ω—è

```bash
cd ~/Documents/esp32
git pull
pio run -t upload
```

–ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ OTA —á–µ—Ä–µ–∑ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å: http://[ESP32_IP]/update
