# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–∏ –∑ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è–º–∏ Bluetti EB3A

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤—ñ–¥ Bluetti EB3A –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å, —Ö–æ—á–∞:
- ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ
- ‚úÖ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∑–Ω–∞–π–¥–µ–Ω—ñ
- ‚úÖ –ü—ñ–¥–ø–∏—Å–∫–∞ —É—Å–ø—ñ—à–Ω–∞ (`canNotify: YES`)
- ‚úÖ –ö–æ–º–∞–Ω–¥–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ
- ‚ùå Callback –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è (`*** CALLBACK CALLED ***` –Ω–µ –∑'—è–≤–ª—è—î—Ç—å—Å—è)

## üéØ –ù–∞–π—ñ–º–æ–≤—ñ—Ä–Ω—ñ—à—ñ –ø—Ä–∏—á–∏–Ω–∏

### 1. Bluetti –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é (90% –π–º–æ–≤—ñ—Ä–Ω—ñ—Å—Ç—å)

**Bluetti EB3A –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ –û–î–ù–ï –æ–¥–Ω–æ—á–∞—Å–Ω–µ BLE –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.**

–Ø–∫—â–æ Home Assistant addon "Bluetti to MQTT" –ø—Ä–∞—Ü—é—î, ESP32 **–ù–ï –ó–ú–û–ñ–ï** –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–Ω—ñ.

**–†—ñ—à–µ–Ω–Ω—è:**
1. –í–∏–º–∫–Ω—ñ—Ç—å Home Assistant addon:
   ```
   Home Assistant ‚Üí Settings ‚Üí Add-ons ‚Üí Bluetti to MQTT ‚Üí STOP
   ```
2. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ addon –Ω–µ –∑–∞–ø—É—Å–∫–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å Bluetti EB3A (–≤–∏–º–∫–Ω—ñ—Ç—å/—É–≤—ñ–º–∫–Ω—ñ—Ç—å)
4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å ESP32

### 2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥

–î–µ—è–∫—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó Bluetti –ø–æ—Ç—Ä–µ–±—É—é—Ç—å **—Ç–æ—á–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ** –∫–æ–º–∞–Ω–¥ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π.

**–ü–æ—Ç–æ—á–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å:**
1. –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ Bluetti
2. –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
3. –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
4. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó (`0xAA 0x55 0x90 0xEB` —Ç–∞ `0x01 0x03 0x00 0x00 0x00 0x00`)
5. –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥–∏ —Å—Ç–∞—Ç—É—Å—É (`0x01 0x03 0x00 0x00 0x00 0x20`)

**–ú–æ–∂–ª–∏–≤—ñ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:**
- –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å—Ç–∞—Ç—É—Å—É **–û–î–†–ê–ó–£** –ø—ñ—Å–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏ (–±–µ–∑ –∑–∞—Ç—Ä–∏–º–∫–∏)
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ `write-without-response` –∑–∞–º—ñ—Å—Ç—å `write-with-response`
- –î–æ–¥–∞—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫—É –º—ñ–∂ –∫–æ–º–∞–Ω–¥–∞–º–∏ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Ç–∞ —Å—Ç–∞—Ç—É—Å—É

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ UUIDs

**–ü–æ—Ç–æ—á–Ω—ñ UUIDs:**
- Service: `0000ff00-0000-1000-8000-00805f9b34fb`
- Notify: `0000ff01-0000-1000-8000-00805f9b34fb`
- Write: `0000ff02-0000-1000-8000-00805f9b34fb`

**–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞:**
1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ nRF Connect –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ
2. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ Bluetti EB3A
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ UUIDs —Å–µ—Ä–≤—ñ—Å—ñ–≤ —Ç–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
4. –ü–æ—Ä—ñ–≤–Ω—è–π—Ç–µ –∑ —Ç–∏–º–∏, —â–æ –≤ –∫–æ–¥—ñ

### 4. –ü—Ä–æ–±–ª–µ–º–∞ –∑ NimBLE –±—ñ–±–ª—ñ–æ—Ç–µ–∫–æ—é

–ú–æ–∂–ª–∏–≤–æ, –ø–æ—Ç—Ä—ñ–±–Ω–∞ —ñ–Ω—à–∞ –≤–µ—Ä—Å—ñ—è NimBLE –∞–±–æ —ñ–Ω—à–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:**
- ESP32 BLE Arduino (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∞, –∞–ª–µ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏)
- BLEDevice (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ ESP32 BLE –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞)

## üîß –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–ø–∏—Å–∫–∏

–î–æ–¥–∞–π—Ç–µ –≤ –∫–æ–¥ –ø—ñ—Å–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏:
```cpp
if (subscribed) {
    Serial.println("[Bluetti] Checking subscription status...");
    delay(1000);
    // –°–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ (—è–∫—â–æ –º–æ–∂–ª–∏–≤–æ)
    if (notifyCharacteristic->canRead()) {
        std::string value = notifyCharacteristic->readValue();
        Serial.printf("[Bluetti] Read value length: %d\n", value.length());
    }
}
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ callback

–î–æ–¥–∞–π—Ç–µ –≤ `notificationThunk`:
```cpp
void BluettiDevice::notificationThunk(...) {
    Serial.println("[Bluetti] ========== CALLBACK CALLED ==========");
    Serial.printf("[Bluetti] characteristic=%p\n", characteristic);
    Serial.printf("[Bluetti] length=%d, isNotify=%d\n", length, isNotify);
    // ... —Ä–µ—à—Ç–∞ –∫–æ–¥—É
}
```

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è Bluetti –¥–æ —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤

1. **Home Assistant:**
   - Settings ‚Üí Add-ons ‚Üí Bluetti to MQTT ‚Üí Logs
   - –Ø–∫—â–æ —î –∞–∫—Ç–∏–≤–Ω—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è, –≤–∏–º–∫–Ω—ñ—Ç—å addon

2. **–°–º–∞—Ä—Ç—Ñ–æ–Ω:**
   - –í–∏–º–∫–Ω—ñ—Ç—å Bluetooth –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ
   - –ê–±–æ –∑–∞–∫—Ä–∏–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫ BLUETTI

3. **–Ü–Ω—à—ñ ESP32/Arduino:**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –Ω–µ–º–∞—î —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤, —è–∫—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–æ Bluetti

## üõ†Ô∏è –ú–æ–∂–ª–∏–≤—ñ —Ä—ñ—à–µ–Ω–Ω—è

### –†—ñ—à–µ–Ω–Ω—è 1: –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥

–°–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∫–æ–º–∞–Ω–¥—É —Å—Ç–∞—Ç—É—Å—É **–ë–ï–ó** –∫–æ–º–∞–Ω–¥ –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó:
```cpp
// –ü—ñ—Å–ª—è –ø—ñ–¥–ø–∏—Å–∫–∏:
delay(1000);
static const uint8_t statusCmd[] = {0x01, 0x03, 0x00, 0x00, 0x00, 0x20};
writeCharacteristic->writeValue(statusCmd, sizeof(statusCmd), false); // without-response
```

### –†—ñ—à–µ–Ω–Ω—è 2: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è read –∑–∞–º—ñ—Å—Ç—å notify

–Ø–∫—â–æ –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å, —Å–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä—ñ–æ–¥–∏—á–Ω–æ —á–∏—Ç–∞—Ç–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É:
```cpp
if (notifyCharacteristic->canRead()) {
    std::string value = notifyCharacteristic->readValue();
    if (value.length() > 0) {
        handleNotification((uint8_t*)value.data(), value.length());
    }
}
```

**–£–í–ê–ì–ê:** –¶–µ –º–µ–Ω—à –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ, –∞–ª–µ –º–æ–∂–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏, —è–∫—â–æ notify –Ω–µ –ø—Ä–∞—Ü—é—î.

### –†—ñ—à–µ–Ω–Ω—è 3: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ nRF Connect

1. –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å nRF Connect –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω
2. –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å—Å—è –¥–æ Bluetti EB3A
3. –ó–Ω–∞–π–¥—ñ—Ç—å —Å–µ—Ä–≤—ñ—Å `0000ff00-...`
4. –ü—ñ–¥–ø–∏—à—ñ—Ç—å—Å—è –Ω–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫—É `0000ff01-...`
5. –í—ñ–¥–ø—Ä–∞–≤—Ç–µ –∫–æ–º–∞–Ω–¥—É —Å—Ç–∞—Ç—É—Å—É —á–µ—Ä–µ–∑ `0000ff02-...`
6. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —á–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó

–Ø–∫—â–æ –≤ nRF Connect –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó **–ü–†–ê–¶–Æ–Æ–¢–¨**, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–¥—ñ ESP32.
–Ø–∫—â–æ –≤ nRF Connect –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó **–ù–ï –ü–†–ê–¶–Æ–Æ–¢–¨**, –ø—Ä–æ–±–ª–µ–º–∞ –≤ Bluetti –∞–±–æ –≤—ñ–Ω –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π –¥–æ —ñ–Ω—à–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é.

## üìã –ß–µ–∫–ª–∏—Å—Ç

- [ ] Home Assistant addon –≤–∏–º–∫–Ω–µ–Ω–æ
- [ ] Bluetooth –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ –≤–∏–º–∫–Ω–µ–Ω–æ
- [ ] Bluetti EB3A –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ
- [ ] ESP32 –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–æ
- [ ] UUIDs –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω—ñ —á–µ—Ä–µ–∑ nRF Connect
- [ ] –ü—ñ–¥–ø–∏—Å–∫–∞ —É—Å–ø—ñ—à–Ω–∞ (`canNotify: YES`)
- [ ] –ö–æ–º–∞–Ω–¥–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —É—Å–ø—ñ—à–Ω–æ
- [ ] Callback –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è

## üîó –ö–æ—Ä–∏—Å–Ω—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Bluetti Community Forum](https://community.bluettipower.com/)
- [ESP32 BLE Documentation](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/bluetooth/esp_ble.html)
- [NimBLE Arduino Documentation](https://github.com/h2zero/NimBLE-Arduino)

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

**Bluetti EB3A –ø—ñ–¥—Ç—Ä–∏–º—É—î –ª–∏—à–µ –û–î–ù–ï –æ–¥–Ω–æ—á–∞—Å–Ω–µ BLE –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.**

–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ ESP32, **–í–ò–ú–ö–ù–Ü–¢–¨** –≤—Å—ñ —ñ–Ω—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó, —è–∫—ñ –º–æ–∂—É—Ç—å –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –¥–æ Bluetti:
- Home Assistant addon
- –°–º–∞—Ä—Ç—Ñ–æ–Ω –∑ –¥–æ–¥–∞—Ç–∫–æ–º BLUETTI
- –Ü–Ω—à—ñ ESP32/Arduino –ø—Ä–∏—Å—Ç—Ä–æ—ó

---

**–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:** 2025-12-01




