# üîÑ –Ø–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ñ–¥–∫–ª—é—á–∏—Ç–∏ Bluetti –≤—ñ–¥ "Bluetti to MQTT"

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ: Bluetti –¥–æ–∑–≤–æ–ª—è—î –ª–∏—à–µ –û–î–ù–ï BLE –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ–¥–Ω–æ—á–∞—Å–Ω–æ!

Bluetti EB3A –º–æ–∂–µ "–∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏" –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –∞–¥–¥–æ–Ω—É "Bluetti to MQTT" —ñ –±–ª–æ–∫—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó. –û—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –¥—ñ–π:

## üìã –ü–æ–∫—Ä–æ–∫–æ–≤–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è

### 1Ô∏è‚É£ –ó—É–ø–∏–Ω—ñ—Ç—å –∞–¥–¥–æ–Ω "Bluetti to MQTT"

–í Home Assistant:
- **Settings** ‚Üí **Add-ons** ‚Üí **Bluetti to MQTT**
- –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **STOP**
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ —Å—Ç–∞—Ç—É—Å: **Stopped**
- **–í–ê–ñ–õ–ò–í–û:** –ó–Ω—ñ–º—ñ—Ç—å –ø—Ä–∞–ø–æ—Ä–µ—Ü—å **"Start on boot"** (—è–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ)

### 2Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Bluetti EB3A

**–¶–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –≤–∞–∂–ª–∏–≤–æ!**

1. –í–∏–º–∫–Ω—ñ—Ç—å Bluetti EB3A (–Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å —ñ —É—Ç—Ä–∏–º—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –∂–∏–≤–ª–µ–Ω–Ω—è)
2. –ü–æ—á–µ–∫–∞–π—Ç–µ **10-15 —Å–µ–∫—É–Ω–¥**
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å Bluetti –∑–Ω–æ–≤—É
4. **–ü–æ—á–µ–∫–∞–π—Ç–µ 30 —Å–µ–∫—É–Ω–¥** –ø—ñ—Å–ª—è —É–≤—ñ–º–∫–Ω–µ–Ω–Ω—è

### 3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —ñ–Ω—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó –≤—ñ–¥–∫–ª—é—á–µ–Ω—ñ

- –í–∏–º–∫–Ω—ñ—Ç—å Bluetooth –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ/–ø–ª–∞–Ω—à–µ—Ç—ñ (—è–∫—â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ Bluetti)
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –∂–æ–¥–Ω—ñ —ñ–Ω—à—ñ –ø—Ä–∏—Å—Ç—Ä–æ—ó –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω—ñ –¥–æ Bluetti

### 4Ô∏è‚É£ –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å ESP32

–ü—ñ—Å–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫—Ä–æ–∫—ñ–≤ 1-3:
- ESP32 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–Ω–∞–π–¥–µ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–∏—Ç—å—Å—è –¥–æ Bluetti
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ ESP32 - –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è: `[Bluetti] ‚úÖ Found device` –∞–±–æ `Bluetti connected`

## üîß –©–æ —Ä–æ–±–∏—Ç—å –∫–æ–¥ ESP32

ESP32 –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:
1. **–û—á–∏—â–∞—î bonding –¥–∞–Ω—ñ** –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó BLE
2. **–í–∏–¥–∞–ª—è—î bonding –¥–ª—è Bluetti** –ø–µ—Ä–µ–¥ –∫–æ–∂–Ω–∏–º –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
3. **–ü—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –ë–ï–ó bonding** (–Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è)

–¶–µ –¥–æ–∑–≤–æ–ª—è—î –ø—ñ–¥–∫–ª—é—á–∞—Ç–∏—Å—è –Ω–∞–≤—ñ—Ç—å —è–∫—â–æ Bluetti "–∑–∞–ø–∞–º'—è—Ç–∞–≤" –ø–æ–ø–µ—Ä–µ–¥–Ω—î –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è.

## ‚ùå –Ø–∫—â–æ –≤—Å–µ –æ–¥–Ω–æ –Ω–µ –ø—Ä–∞—Ü—é—î

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ü–æ–≤–Ω–µ —Å–∫–∏–¥–∞–Ω–Ω—è Bluetti
1. –í–∏–º–∫–Ω—ñ—Ç—å Bluetti
2. –ü–æ—á–µ–∫–∞–π—Ç–µ **30 —Å–µ–∫—É–Ω–¥**
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å –∑–Ω–æ–≤—É
4. –ü–æ—á–µ–∫–∞–π—Ç–µ **1 —Ö–≤–∏–ª–∏–Ω—É** (Bluetti –ø–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å—Å—è)
5. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—è –∑–Ω–æ–≤—É

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ MAC –∞–¥—Ä–µ—Å—É
1. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ BLE —Å–∫–∞–Ω–µ—Ä (nRF Connect –Ω–∞ —Å–º–∞—Ä—Ç—Ñ–æ–Ω—ñ)
2. –ó–Ω–∞–π–¥—ñ—Ç—å Bluetti –≤ —Å–ø–∏—Å–∫—É –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ MAC –∞–¥—Ä–µ—Å—É
4. –û–Ω–æ–≤—ñ—Ç—å MAC –∞–¥—Ä–µ—Å—É –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö ESP32

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –≤—ñ–¥—Å—Ç–∞–Ω—å
- Bluetti –º–∞—î –±—É—Ç–∏ –≤ –º–µ–∂–∞—Ö **10 –º–µ—Ç—Ä—ñ–≤** –≤—ñ–¥ ESP32
- –ü–µ—Ä–µ—à–∫–æ–¥–∏ (—Å—Ç—ñ–Ω–∏, –º–µ—Ç–∞–ª–µ–≤—ñ –ø—Ä–µ–¥–º–µ—Ç–∏) –∑–º–µ–Ω—à—É—é—Ç—å –¥–∞–ª—å–Ω—ñ—Å—Ç—å

## üìù –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

### BLE Bonding
Bluetti –º–æ–∂–µ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ bonding (–∑–≤'—è–∑–æ–∫) –∑ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º –ø—Ä–∏—Å—Ç—Ä–æ—î–º. –¶–µ –æ–∑–Ω–∞—á–∞—î:
- –ü—Ä–∏—Å—Ç—Ä—ñ–π "–∑–∞–ø–∞–º'—è—Ç–æ–≤—É—î—Ç—å—Å—è" –≤ Bluetti
- Bluetti –º–æ–∂–µ –≤—ñ–¥—Ö–∏–ª—è—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—ñ–¥ —ñ–Ω—à–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
- –ü–æ—Ç—Ä—ñ–±–Ω–æ –æ—á–∏—Å—Ç–∏—Ç–∏ bonding –∞–±–æ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Bluetti

### –†—ñ—à–µ–Ω–Ω—è –≤ –∫–æ–¥—ñ
```cpp
// –û—á–∏—â–∞—î–º–æ –≤—Å—ñ bonding –¥–∞–Ω—ñ –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
NimBLEDevice::deleteAllBonds();

// –í–∏–¥–∞–ª—è—î–º–æ bonding –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏—Å—Ç—Ä–æ—é –ø–µ—Ä–µ–¥ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º
NimBLEDevice::deleteBond(address);

// –ü—ñ–¥–∫–ª—é—á–∞—î–º–æ—Å—è –ë–ï–ó bonding (–Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è)
client->connect(address, false);
```

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —É—Å–ø—ñ—à–Ω–æ–≥–æ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

–í –ª–æ–≥–∞—Ö ESP32 –º–∞—î –∑'—è–≤–∏—Ç–∏—Å—è:
```
[Bluetti] ‚úÖ Found device: EB3A (D1:4C:11:6B:6A:3D)
[Bluetti] Device found, attempting connection...
[Bluetti] Setting up characteristics...
[Bluetti] Service found
[Bluetti] Characteristics found
Bluetti connected
```

–Ø–∫—â–æ –±–∞—á–∏—Ç–µ —Ü—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è - –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–µ! üéâ

