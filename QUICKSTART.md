# üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

- [ ] **–í–ò–ú–ö–ù–£–¢–ò** –∞–¥–¥–æ–Ω "Bluetti to MQTT" –≤ Home Assistant
- [ ] –î—ñ–∑–Ω–∞—Ç–∏—Å—å MAC –∞–¥—Ä–µ—Å—É Bluetti: `D1:4C:11:6B:6A:3D`
- [ ] –î—ñ–∑–Ω–∞—Ç–∏—Å—å IP –∞–¥—Ä–µ—Å—É Home Assistant
- [ ] –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ Mosquitto MQTT –ø—Ä–∞—Ü—é—î
- [ ] –ú–∞—Ç–∏ –ø—ñ–¥ —Ä—É–∫–æ—é WiFi SSID —Ç–∞ –ø–∞—Ä–æ–ª—å

---

## üìù –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞ 3 —Ö–≤–∏–ª–∏–Ω–∏

### 1Ô∏è‚É£ –í—ñ–¥—Ä–µ–¥–∞–≥—É–≤–∞—Ç–∏ `src/main.cpp` (—Ä—è–¥–∫–∏ 7-18):

```cpp
const char* WIFI_SSID = "–í–ê–®_WIFI";
const char* WIFI_PASSWORD = "–í–ê–®_–ü–ê–†–û–õ–¨";
const char* MQTT_SERVER = "192.168.1.XXX";    // IP Home Assistant
const char* MQTT_USER = "homeassistant";      // –∞–±–æ –∑–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º
const char* MQTT_PASSWORD = "–≤–∞—à_–ø–∞—Ä–æ–ª—å";     // –∞–±–æ –∑–∞–ª–∏—à—Ç–µ –ø–æ—Ä–æ–∂–Ω—ñ–º
const char* BLUETTI_MAC = "D1:4C:11:6B:6A:3D"; // –≤–∞—à–∞ MAC –∞–¥—Ä–µ—Å–∞
const bool USE_MAC_ADDRESS = true;
```

### 3Ô∏è‚É£ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø—Ä–æ—à–∏–≤–∫—É:

**–ü–µ—Ä—à–∏–π —Ä–∞–∑ (—á–µ—Ä–µ–∑ USB):**
```bash
cd ~/Documents/esp32
make upload      # –∞–±–æ: pio run --target upload
```

**–ù–∞—Å—Ç—É–ø–Ω—ñ —Ä–∞–∑–∏ (—á–µ—Ä–µ–∑ WiFi OTA):** üÜï
```bash
make ota         # –∞–≤—Ç–æ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è
# –∞–±–æ
make ota IP=192.168.1.100
```

–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ: `OTA_GUIDE.md`
### 3Ô∏è‚É£ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–≥–∏:

```bash
pio device monitor
```

–ú–∞—î –±—É—Ç–∏:
```
=== Bluetti EB3A Bridge ===
Connected to Bluetti device by MAC!
WiFi connected!
MQTT connected!
Published state to MQTT: SUCCESS ‚úì
```

---

## üè† Home Assistant

### –ü—Ä–∏—Å—Ç—Ä–æ—ó –∑'—è–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ:

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ **Settings** ‚Üí **Devices & Services** ‚Üí **MQTT**

–ó–Ω–∞–π–¥—ñ—Ç—å –ø—Ä–∏—Å—Ç—Ä—ñ–π **"Bluetti EB3A"** –∑ —Å–µ–Ω—Å–æ—Ä–∞–º–∏:
- Battery Level (%)
- AC Output Power (W)
- AC Output (switch)
- DC Output (switch)

### –®–≤–∏–¥–∫–∏–π —Ç–µ—Å—Ç:

1. **Developer Tools** ‚Üí **Services**
2. –°–µ—Ä–≤—ñ—Å: `switch.turn_on`
3. Target: `switch.bluetti_eb3a_ac_output`
4. **Call Service**

AC –≤–∏—Ö—ñ–¥ –º–∞—î —É–≤—ñ–º–∫–Ω—É—Ç–∏—Å—å! ‚ö°

---

## üîß –Ø–∫—â–æ —â–æ—Å—å –Ω–µ –ø—Ä–∞—Ü—é—î

| –ü—Ä–æ–±–ª–µ–º–∞ | –†—ñ—à–µ–Ω–Ω—è |
|----------|---------|
| ESP32 –Ω–µ –±–∞—á–∏—Ç—å Bluetti | –í–∏–º–∫–Ω—ñ—Ç—å –∞–¥–¥–æ–Ω HA, –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Bluetti |
| –ù–µ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ WiFi | –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ SSID —Ç–∞ –ø–∞—Ä–æ–ª—å |
| –ù–µ –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ MQTT | –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ IP —Ç–∞ –ø–æ—Ä—Ç 1883 |
| HA –Ω–µ –±–∞—á–∏—Ç—å –ø—Ä–∏—Å—Ç—Ä–æ—ó | –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —â–æ MQTT Discovery —É–≤—ñ–º–∫–Ω–µ–Ω–æ |
| –ö–æ–º–∞–Ω–¥–∏ –Ω–µ –ø—Ä–∞—Ü—é—é—Ç—å | –ü–æ—Ç—Ä—ñ–±–Ω–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª (–¥–∏–≤. README) |

---

## üìù –ö–æ—Ä–∏—Å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏

```bash
# –ü–µ—Ä—à–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
pio run --target upload

# OTA –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (WiFi) üÜï
make ota
make ota IP=192.168.1.100

# –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å –ª–æ–≥–∏
pio device monitor

# –í–∏–π—Ç–∏ –∑ –º–æ–Ω—ñ—Ç–æ—Ä–∞
Ctrl+C

# –û—á–∏—Å—Ç–∏—Ç–∏ —ñ –ø–µ—Ä–µ—Å—ñ–±—Ä–∞—Ç–∏
pio run --target clean
pio run

# –î—ñ–∑–Ω–∞—Ç–∏—Å—å –ø–æ—Ä—Ç ESP32
pio device list
```

---

## üéØ –©–æ –¥–∞–ª—ñ?

### üí° –ö–µ—Ä—É–≤–∞–Ω–Ω—è –¥–∏—Å–ø–ª–µ—î–º

–î–∏—Å–ø–ª–µ–π **–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–º–∏–∫–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥** –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –µ–Ω–µ—Ä–≥—ñ—ó:
- **–ö–Ω–æ–ø–∫–∞ 1** (–≤–µ—Ä—Ö–Ω—è, GPIO 35) - —É–≤—ñ–º–∫–Ω—É—Ç–∏ –Ω–∞ 10 —Å–µ–∫
- **–ö–Ω–æ–ø–∫–∞ 2** (–Ω–∏–∂–Ω—è, GPIO 0) - —É–≤—ñ–º–∫–Ω—É—Ç–∏ –Ω–∞ 10 —Å–µ–∫

### üè† Home Assistant

1. **–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó** –≤ Home Assistant
2. **–ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è** –ø—Ä–∏ –Ω–∏–∑—å–∫–æ–º—É –∑–∞—Ä—è–¥—ñ
3. **–î–æ–¥–∞—Ç–∏ –≤ Lovelace** –¥–∞—à–±–æ—Ä–¥
4. **–Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ Energy Dashboard**

–î–∏–≤—ñ—Ç—å—Å—è –ø—Ä–∏–∫–ª–∞–¥–∏ –≤ `README.md` —Ç–∞ `SETUP_GUIDE.md`

---

–ì–æ—Ç–æ–≤–æ! üéâ ESP32 —Ç–µ–ø–µ—Ä –∫–µ—Ä—É—î –≤–∞—à–∏–º Bluetti EB3A!
