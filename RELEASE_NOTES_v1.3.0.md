# –û–Ω–æ–≤–ª–µ–Ω–Ω—è v1.3.0 - Power Save Mode üîã

## –©–æ –Ω–æ–≤–æ–≥–æ

### ‚ö° WiFi Power Save
- **WIFI_PS_MAX_MODEM** - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –µ–∫–æ–Ω–æ–º—ñ—è –µ–Ω–µ—Ä–≥—ñ—ó –∫–æ–ª–∏ WiFi –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π
- **Disconnected PM** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è WiFi –∫–æ–ª–∏ –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π
- **–î–æ 50% –º–µ–Ω—à–µ** —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó WiFi –º–æ–¥—É–ª–µ–º

### üîµ Bluetooth Power Save
- **Smart Polling** - —Ä–æ–∑—É–º–Ω–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è –∑ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
- **BLE Coexistence** - –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –¥–ª—è —Ä–æ–±–æ—Ç–∏ —Ä–∞–∑–æ–º –∑ WiFi
- **–ë–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–π TX Power** - +3dBm –¥–ª—è –µ–∫–æ–Ω–æ–º—ñ—ó –µ–Ω–µ—Ä–≥—ñ—ó

### üì° Smart Polling (–†–æ–∑—É–º–Ω–µ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è)

#### WiFi
- **–®–≤–∏–¥–∫–∏–π —Ä–µ–∂–∏–º**: –ö–æ–∂–Ω—ñ 3 —Å–µ–∫—É–Ω–¥–∏ (–ø–µ—Ä—à—ñ 10 —Å–ø—Ä–æ–±)
- **–ü–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º**: –ö–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω (–ø—ñ—Å–ª—è 10 –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–±)

#### Bluetti
- **–®–≤–∏–¥–∫–∏–π —Ä–µ–∂–∏–º**: –ö–æ–∂–Ω—ñ 10 —Å–µ–∫—É–Ω–¥ (–ø–µ—Ä—à—ñ 6 —Å–ø—Ä–æ–±)
- **–ü–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º**: –ö–æ–∂–Ω—ñ 5 —Ö–≤–∏–ª–∏–Ω (–ø—ñ—Å–ª—è 6 –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–±)

## –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

### –ß–∞—Å —Ä–æ–±–æ—Ç–∏ –≤—ñ–¥ –±–∞—Ç–∞—Ä–µ—ó (650 mAh)

| –†–µ–∂–∏–º | –ë–µ–∑ Power Save | –ó Power Save | –ó–±—ñ–ª—å—à–µ–Ω–Ω—è |
|-------|----------------|--------------|------------|
| WiFi+BLE –∞–∫—Ç–∏–≤–Ω—ñ | ~4 –≥–æ–¥ | ~6-8 –≥–æ–¥ | **+50-100%** |
| –¢—ñ–ª—å–∫–∏ BLE | ~5 –≥–æ–¥ | ~9-10 –≥–æ–¥ | **+80-100%** |
| –ü–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º | ~6 –≥–æ–¥ | ~20+ –≥–æ–¥ | **+233%** |

## –©–æ —Ü–µ –æ–∑–Ω–∞—á–∞—î –¥–ª—è –≤–∞—Å

### ‚úÖ –ö–æ–ª–∏ WiFi –¥–æ—Å—Ç—É–ø–Ω–∏–π
- ESP32 –ø—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è —à–≤–∏–¥–∫–æ (3 —Å–µ–∫—É–Ω–¥–∏ –º—ñ–∂ —Å–ø—Ä–æ–±–∞–º–∏)
- WiFi –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞—Å–∏–Ω–∞—î –º—ñ–∂ –ø–∞–∫–µ—Ç–∞–º–∏ (–µ–∫–æ–Ω–æ–º—ñ—è 40-50%)
- Bluetooth –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- –í–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–∞ MQTT –ø—Ä–∞—Ü—é—é—Ç—å –±–µ–∑ –∑–º—ñ–Ω

### ‚úÖ –ö–æ–ª–∏ WiFi –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π
- –ü—ñ—Å–ª—è 10 –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–± (30 —Å–µ–∫—É–Ω–¥) ‚Üí –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
- ESP32 –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å —Ç—ñ–ª—å–∫–∏ —Ä–∞–∑ –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
- Bluetooth –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **–ï–∫–æ–Ω–æ–º—ñ—è –¥–æ 70%** –µ–Ω–µ—Ä–≥—ñ—ó

### ‚úÖ –ö–æ–ª–∏ Bluetti –≤–∏–º–∫–Ω–µ–Ω–∏–π
- –ü—ñ—Å–ª—è 6 –Ω–µ–≤–¥–∞–ª–∏—Ö —Å–ø—Ä–æ–± (60 —Å–µ–∫—É–Ω–¥) ‚Üí –ø–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
- ESP32 –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏—Å—å —Ç—ñ–ª—å–∫–∏ —Ä–∞–∑ –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
- WiFi –ø—Ä–æ–¥–æ–≤–∂—É—î –ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **–ï–∫–æ–Ω–æ–º—ñ—è –¥–æ 50%** –µ–Ω–µ—Ä–≥—ñ—ó BLE

### ‚úÖ –ö–æ–ª–∏ –≤—Å–µ –≤–∏–º–∫–Ω–µ–Ω–æ (WiFi + Bluetti)
- –û–±–∏–¥–≤–∞ –º–æ–¥—É–ª—ñ –≤ –ø–æ–≤—ñ–ª—å–Ω–æ–º—É —Ä–µ–∂–∏–º—ñ
- –°–ø—Ä–æ–±–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ä–∞–∑ –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
- **–ï–∫–æ–Ω–æ–º—ñ—è –¥–æ 80%** –µ–Ω–µ—Ä–≥—ñ—ó
- **20+ –≥–æ–¥–∏–Ω** —Ä–æ–±–æ—Ç–∏ –≤—ñ–¥ –±–∞—Ç–∞—Ä–µ—ó!

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –≤ Serial Monitor

### –ü—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
```
=== Power Save Mode Enabled ===
[WiFi] Smart polling: Fast retry every 3 seconds, Slow retry every 5 minutes
[Bluetti] Smart polling: Fast retry every 10 seconds, Slow retry every 5 minutes
```

### –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
```
[WiFi] Switching to slow polling mode (every 5 minutes)
[Bluetti] Switching to slow polling mode (every 5 minutes)
[Bluetti] üí° This saves power when Bluetti is OFF
```

### –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è
```
WiFi connected, IP: 192.168.1.100
[WiFi] Power Save enabled (MAX_MODEM)
[Bluetti] Connected, reset to fast polling mode
```

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

–í—Å—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤ [src/main.cpp](src/main.cpp):

```cpp
// –Ü–Ω—Ç–µ—Ä–≤–∞–ª–∏ –æ–ø–∏—Ç—É–≤–∞–Ω–Ω—è
const unsigned long WIFI_RETRY_FAST_MS = 3000;         // 3 —Å–µ–∫—É–Ω–¥–∏
const unsigned long WIFI_RETRY_SLOW_MS = 5 * 60 * 1000; // 5 —Ö–≤–∏–ª–∏–Ω
const unsigned long BLUETTI_RETRY_FAST_MS = 10000;      // 10 —Å–µ–∫—É–Ω–¥
const unsigned long BLUETTI_RETRY_SLOW_MS = 5 * 60 * 1000; // 5 —Ö–≤–∏–ª–∏–Ω

// –ö—ñ–ª—å–∫—ñ—Å—Ç—å —à–≤–∏–¥–∫–∏—Ö —Å–ø—Ä–æ–± –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ –ø–æ–≤—ñ–ª—å–Ω–∏–π —Ä–µ–∂–∏–º
const uint8_t WIFI_FAST_ATTEMPTS = 10;
const uint8_t BLUETTI_FAST_ATTEMPTS = 6;
```

## –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–î–∏–≤—ñ—Ç—å—Å—è [POWER_SAVE_GUIDE.md](POWER_SAVE_GUIDE.md) –¥–ª—è:
- –î–µ—Ç–∞–ª—å–Ω–∏—Ö —Ç–µ—Ö–Ω—ñ—á–Ω–∏—Ö –ø–æ—è—Å–Ω–µ–Ω—å
- –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤
- –£—Å—É–Ω–µ–Ω–Ω—è –Ω–µ—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π
- –í–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è —Å–ø–æ–∂–∏–≤–∞–Ω–Ω—è
- –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

## –°—É–º—ñ—Å–Ω—ñ—Å—Ç—å

‚úÖ –ü—Ä–∞—Ü—é—î –∑ —É—Å—ñ–º–∞ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–º–∏ –≤–µ—Ä—Å—ñ—è–º–∏  
‚úÖ –ù–µ –ø–æ—Ç—Ä–µ–±—É—î –∑–º—ñ–Ω –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è –ø—ñ—Å–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è  
‚úÖ –°—É–º—ñ—Å–Ω–æ –∑ MQTT, Web-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º, OTA  

## –û–Ω–æ–≤–ª–µ–Ω–Ω—è

1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –Ω–æ–≤—É –ø—Ä–æ—à–∏–≤–∫—É
2. Power Save –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è
3. –ú–æ–Ω—ñ—Ç–æ—Ä—Ç–µ Serial Monitor –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è

```bash
pio run -t upload && pio device monitor
```

–ê–±–æ —á–µ—Ä–µ–∑ OTA:
1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–µ–±-—ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å
2. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ firmware.bin
3. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –ø—Ä–∏—Å—Ç—Ä—ñ–π

---

**–†–æ–∑—Ä–æ–±–Ω–∏–∫**: kekcick  
**–î–∞—Ç–∞**: 28 –≥—Ä—É–¥–Ω—è 2025  
**–í–µ—Ä—Å—ñ—è**: 1.3.0  
**–õ—ñ—Ü–µ–Ω–∑—ñ—è**: MIT
